version: "v1.0"
contract: TASK_STATE_MACHINE_TEAM

states:
  - PENDING
  - RUNNING
  - LOCKED_FILE
  - AWAITING_REVIEW
  - TESTSPRITE_PASS
  - DOCTOR1_PASS
  - DOCTOR2_PASS
  - COMMITTED
  - DONE
  - FAILED
  - CANCELED

recovery:
  on_TESTSPRITE_FAIL: "retry_from_RUNNING"
  on_DOCTOR1_FAIL: "retry_from_TESTSPRITE_PASS"
  on_DOCTOR2_FAIL: "retry_from_DOCTOR1_PASS"
  on_COMMIT_FAIL: "retry_from_DOCTOR2_PASS"

rules:
  - "Never retry from zero when intermediate evidence exists"
  - "Every transition emits audit event"
