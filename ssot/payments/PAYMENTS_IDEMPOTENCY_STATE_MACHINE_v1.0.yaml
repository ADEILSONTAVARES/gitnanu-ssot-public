payments_idempotency_state_machine:
  version: "v1.0"
  idempotency:
    rule: "UNIQUE(provider, provider_payment_id) + lock por chave"
    stripe_key: "evt_{stripe_event_id}"
    hotmart_key: "hot_{transaction_id}"
  states: [trialing, active, past_due, incomplete, incomplete_expired, canceled, unpaid]
  reconciliation:
    schedule: "daily"
    rule: "divergência gera receipt de reconciliação"
